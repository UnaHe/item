{{partial("layout/header")}}
{{stylesheet_link("leaflet/leaflet.css")}}
{{stylesheet_link("leaflet/L.Icon.Pulse.css")}}
<section id="content_wrapper">
    <div id="topbar">
        <div class="topbar-left">
            <ol class="breadcrumb">
                <li class="crumb-active"><a href="#">商家账号列表</a></li>
                <li class="crumb-icon"><a href="/{{routerProjectId}}/index/index"><span class="glyphicon glyphicon-home"></span></a></li>
                <li class="crumb-link"><a href="/{{routerProjectId}}/index/index">{{"Home"|_}}</a></li>
                <li class="crumb-trail">商家账号列表</li>
            </ol>
        </div>
    </div>
    <div id="content">
        <div class="row">
            <div class="col-md-12">
                <div class="panel">
                    <div class="panel-heading"> <span class="panel-title"> <span class="glyphicons glyphicons-group"></span> 商家账号列表 </span> <div class="topbar-right" style="margin-right: 10px;">
                        <select class="multiselect" id="department_id" onchange="$('.btn').attr('disabled','disabled');$('#department_id').attr('disabled','disabled');location.href='/{{routerProjectId}}/seller/sellerlist?seller_status='+this.value;">
                            <!--<option value="" {%if status==''%} selected {%endif%}>全部账号</option>-->
                            <option value="0" {%if status==0%} selected {%endif%}>未激活</option>
                            <option value="1" {%if status==1%} selected {%endif%}>审核中</option>
                            <option value="2" {%if status==2%} selected {%endif%}>审核通过</option>
                            <option value="3" {%if status==3%} selected {%endif%}>审核未通过</option>
                        </select>
                    </div> </div>
                    {{javascript_include('client/pagers.js')}}
                    <div class="panel-body pbn">
                        <table class="table table-striped table-bordered table-hover" id="datatable">
                            <thead>
                            <th style="width:1%">店铺头图</th>
                            <th nowrap="">店铺名</th>
                            <th nowrap="">店主名</th>
                            <th nowrap="">所在楼层</th>
                            <th nowrap="">地图点位名</th>
                            <th nowrap="">初始点位账号</th>
                            <th nowrap="">手机账号</th>
                            <th style="width:1%" nowrap="">状态</th>
                            <th style="width:1%" nowrap="">最近变更</th>
                            <th style="width:1%" nowrap="">最近登录</th>
                            <th style="width:1%" class="hidden-xs">操作</th>
                            </thead>
                            <tbody>

                            {%for i in sellerList%}
                                <tr id="{{i['seller_id']}}">
                                <td nowrap="">{%if i['seller_card_img']%}<img src="{%if i['seller_photo_source']=='oss'%}https://signposs1.oss-cn-shenzhen.aliyuncs.com/{%else%}http://apimerchant.signp.cn/{%endif%}{{i['seller_card_img']}}"  width="60">{%else%}<img src="/client/crash.png" />{%endif%}</td>
                                <td class="text-left">{{i['seller_shop_name']}}</td>
                                <td nowrap=""><span class="label" style="color: #00a6b6">{{i['seller_name']}}</span></td>
                                <td nowrap="">{{i['map_name']}}</td>
                                <td nowrap="">{{i['name']}}</td>
                                <td nowrap="">{{i['map_gid']}}</td>
                                <td nowrap="">{{i['seller_tel']}}</td>
                                <td nowrap>
                                    {%if i['seller_status']==0%}<span class="label label-default">未激活</span>
                                    {%elseif i['seller_status']==1%}<span class="label label-info">审核中</span>
                                    {%elseif i['seller_status']==2%}<span class="label label-success">审核通过</span>
                                    {%elseif i['seller_status']==3%}<span class="label label-warning">审核未通过</span>
                                    {%endif%}
                                </td>
                                <td nowrap>{%if i['seller_create_at']%}{{date("Y-m-d",i['seller_create_at'])}}{%else%}---{%endif%}</td>
                                <td nowrap>{%if i['seller_login_at']%}{{date("Y-m-d",i['seller_login_at'])}}{%else%}---{%endif%}</td>
                                <td nowrap>
                                    <button type="button" class="btn btn-default btn-gradient btn-xs" onclick="$('.btn').attr('disabled','disabled');location.href ='/{{routerProjectId}}/seller/sellerhandle?seller_id={{i['seller_id']}}';" style="margin-left: 10px">{{"Edit"|_}}</button>
                                    <button type="button" class="btn btn-default btn-gradient btn-xs" onclick="$('.btn').attr('disabled','disabled');location.href ='/{{routerProjectId}}/seller/promotionlist?seller_id={{i['seller_id']}}';" style="margin-left: 10px">促销信息</button>
                                    <button type="button" class="btn btn-default btn-gradient btn-xs deleteBtn" data-id="{{i['seller_id']}}" style="margin-left: 10px">重置密码</button>
                                </td>
                            </tr>
                            {%endfor%}
                            </tbody>
                        </table>
                        <script language="JavaScript">var pg = new showPages('pg');pg.pageCount = {{pageCount}};pg.printHtml();</script>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

{{partial ("layout/footer")}}
{{javascript_include('client/vendor/plugins/multiselect/bootstrap-multiselect.js')}}
{{javascript_include('client/vendor/plugins/datatables/js/jquery.dataTables.min.js')}}
{{javascript_include('client/vendor/plugins/datatables/js/datatables.js')}}
{{javascript_include('client/vendor/plugins/datatables/extras/TableTools/media/js/TableTools.min.js')}}
{{javascript_include('client/vendor/plugins/datatables/extras/TableTools/media/js/ZeroClipboard.js')}}

{{javascript_include('client/js/main.js')}}
<style>
#datatable_wrapper #datatable_paginate{display:none;}
</style>
<script type="text/javascript">
    function repassword(id){
       $('.btn').attr('disabled','disabled');
        $.ajax('/{{routerProjectId}}/seller/ajaxchangepassword', {
            data: {
                seller_id:id,
            },
            type: 'post',
            dataType: 'json',
            success: function(data)
            {
                if (data.errcode == 0)
                {
                    alert('重置成功');
                    $('#loadings').remove();
                }
            },
            error: function()
            {
                alert('服务器错误');
            },
            complete:function(){
                $('.btn').removeAttr('disabled');
            }
        });
    }
    jQuery(document).ready(function () {
        "use strict";
        // Init Theme Core
        Core.init();

        $('.deleteBtn').each(function(){
            $(this).on('click',function(){
                if (confirm("密码将重置为123456,确定吗？")){
                    $(this).parent().append('{{image("https://signposs1.oss-cn-shenzhen.aliyuncs.com/oss/Images/Icons/Load/load-7.gif",'id':'loadings' ,'width':'20')}}');
                    repassword($(this).attr('data-id'))
                }
            });
        })
        // $('.multiselect').multiselect({enableFiltering: true,maxHeight: 420,buttonWidth:"200px"});
        $('#datatable').dataTable({
            "aoColumnDefs": [{ 'bSortable': false, 'aTargets': [ -1 , 0 , 1,2 ] }],
            "oLanguage": { "oPaginate": {"sPrevious": "", "sNext": ""} },
            "iDisplayLength": 10,
            "aLengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            "sDom": '<"panel-menu dt-panelmenu"lfr><"clearfix">tip',
        });
        $('.dataTables_filter input').attr("placeholder", "搜索");

    });

</script>

</body>
</html>
