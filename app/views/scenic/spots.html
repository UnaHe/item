{{partial("layout/header")}}
<script type="text/javascript" src="/console/pagers.js"></script>
<section id="content_wrapper">
    <div id="topbar">
      <div class="topbar-left">
        <ol class="breadcrumb">
          <li class="crumb-active"><a href="#">{{"ScenicSpots"|_}}</a></li>
          <li class="crumb-icon"><a href="/{{routerProjectId}}/index/index"><span class="glyphicon glyphicon-home"></span></a></li>
          <li class="crumb-link"><a href="/{{routerProjectId}}/index/index">{{"Home"|_}}</a></li>
          <li class="crumb-trail">{{"ScenicManage"|_}}</li>
        </ol>
      </div>
    </div>
    <div id="content">
      <div class="row">
<div class="col-md-12">
<div class="panel">
            <div class="panel-heading"> <span class="panel-title"> <span class="glyphicons glyphicons-unchecked"></span> {{"ScenicSpots"|_}} </span> <div class="topbar-right" style="margin-right: 10px;">
      <select class="multiselect" onchange="$('.btn').attr('disabled','disabled');location.href='/{{routerProjectId}}/scenic/spots?map_id='+this.value;">
                    <option value="">{{'MapList'|_}}</option>
                      {%for i in mapList%}
                      <option value="{{i['map_id']}}"{%if filter['map_id']==i['map_id']%}  selected="selected"{%endif%}>{{i['map_name']}}</option>
                      {%endfor%}
                    </select>
      </div></div>
            <div class="panel-body">
                {%if mapPolygon is defined%}
              <table class="table table-hover">
                <thead>
                                    <th style="text-align: left">景点名称</th>
                                    <th style="width:1%" nowrap="">详情</th>
                                    <th style="width:1%" nowrap="">语音</th>
                                    <th style="width:1%" nowrap="">操作</th>
                </thead>
                                <tbody>
                                     {%for i in mapPolygon['data']%}
                                     <tr id="article_{{i['article_id']}}">
                                         <td style="text-align: left">{{i['name']}} {{i['name_en']}}</td>
                                         <td nowrap>
                                             {%if i['map_polygon_description_content']%}<span class="label label-success">是</span>
                                             {%else%}<span class="label label-default">无</span>
                                             {%endif%}
                                         </td>
                                         <td nowrap>
                                             {%if i['map_polygon_description_voice']%}<span class="label label-success">是</span>
                                             {%else%}<span class="label label-default">无</span>
                                             {%endif%}
                                         </td>
                                         <td nowrap>
                      <button type="button" class="btn btn-info btn-gradient btn-xs" onclick="location.href ='/{{routerProjectId}}/scenic/spothandle?id={{i['map_polygon_id']}}';">{{"EditDetails"|_}}</button>
                    </td>
                                     </tr>
                                     {%endfor%}
                                </tbody>
              </table><script language="JavaScript">
                var pg = new showPages('pg');pg.pageCount = {{mapPolygon['pageCount']}};pg.printHtml();
            </script>{%endif%}
            </div>
          </div>

</div>
          </div>
        </div>
  </section>

{{partial ("layout/footer")}}
{{javascript_include('client/vendor/plugins/multiselect/bootstrap-multiselect.js')}}
<script type="text/javascript" src="https://signposs1.oss-cn-shenzhen.aliyuncs.com/client/js/main.js"></script>
<script type="text/javascript">
function deleteArticle(id){
  console.log('deleteArticle:',id)

  $('.btn').attr('disabled','disabled');
  $.ajax('/{{routerProjectId}}/article/ajaxdelete', {
                data: {
                  article_id:id,
                },
                type: 'post',
                dataType: 'json',
                success: function(data)
                {
                  console.log(data)
                    if (data.errcode == 0)
                    {
                        $('#article_'+id).remove()
                    }else{
                      alert(data.errmsg);
                    }
                },
                error: function()
                {
                    alert('服务器错误');
                },
                complete:function(){
                  $('.btn').removeAttr('disabled');
                }
            });
}
jQuery(document).ready(function () {
   "use strict";
     // Init Theme Core
    Core.init();
    $('.multiselect').multiselect({enableFiltering: false,maxHeight: 420,buttonWidth:"400px"});
    $('.deleteBtn').each(function(){
      $(this).on('click',function(){
        if (confirm("确定要删除此文章？")){
          $(this).parent().append('<img src="https://signposs1.oss-cn-shenzhen.aliyuncs.com/oss/Images/Icons/Load/load-7.gif" width="20" />');
          deleteArticle($(this).attr('data-id'))
        }
      });
    })

});

</script>

</body>
</html>
